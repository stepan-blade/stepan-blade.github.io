<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <title>Crypto Analysis Bot</title>
</head>
<body class="bg-black text-white p-4">

    <div class="bg-zinc-900 p-5 rounded-3xl mb-4 border border-zinc-800 shadow-2xl">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-zinc-500 text-xs uppercase tracking-wider">Демо-баланс</p>
                <h1 id="balance" class="text-3xl font-bold text-yellow-500">$0.00</h1>
            </div>
            <div id="status-badge" class="px-3 py-1 rounded-full text-[10px] font-bold bg-zinc-800 text-zinc-400">
                АНАЛИЗ РЫНКА
            </div>
        </div>
    </div>

    <div class="bg-zinc-900 p-2 rounded-3xl mb-6 border border-zinc-800">
        <div id="chart" class="w-full h-64"></div>
    </div>

    <h2 class="text-lg font-bold mb-3 px-2">История сигналов</h2>
    <div id="history-list" class="space-y-3 pb-20">
        </div>

    <script>
        // Инициализация графика
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { backgroundColor: 'transparent', textColor: '#d1d5db' },
            grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { borderColor: '#374151', timeVisible: true },
        });
        const lineSeries = chart.addLineSeries({ color: '#eab308', lineWidth: 2 });

        async function refresh() {
            const res = await fetch('/api/data');
            const data = await res.json();
            
            // Обновление цифр
            document.getElementById('balance').innerText = `$${data.balance.toFixed(2)}`;
            const badge = document.getElementById('status-badge');
            badge.innerText = data.status;
            badge.className = data.status === "В сделке" ? "px-3 py-1 rounded-full text-[10px] font-bold bg-green-500/20 text-green-500" : "px-3 py-1 rounded-full text-[10px] font-bold bg-zinc-800 text-zinc-400";

            // Обновление графика (принимаем массив точек {time, value})
            if (data.chart_data) {
                lineSeries.setData(data.chart_data);
            }

            // Обновление истории
            const list = document.getElementById('history-list');
            list.innerHTML = data.history.map(trade => `
                <div class="bg-zinc-900 p-4 rounded-2xl flex justify-between border border-zinc-800">
                    <div>
                        <div class="font-bold text-sm">${trade.asset}</div>
                        <div class="text-[10px] text-zinc-500">${trade.time}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${trade.profit.includes('+') ? 'text-green-400' : 'text-red-400'}">${trade.profit}</div>
                        <div class="text-[10px] text-zinc-500">${trade.open} ➔ ${trade.close}</div>
                    </div>
                </div>
            `).join('');
        }

        setInterval(refresh, 5000);
        refresh();
    </script>
</body>
</html>
